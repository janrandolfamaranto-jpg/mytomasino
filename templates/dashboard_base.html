<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Dashboard{% endblock %}</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="{% static 'css/dashboard.css' %}" rel="stylesheet">

  <!-- HTMX -->
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>

  <!-- Font Awesome -->
  <script src="https://kit.fontawesome.com/a2e0e6ad8b.js" crossorigin="anonymous"></script>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="profile-section">
      {% if request.user.profile.profile_picture %}
        <img src="{{ request.user.profile.profile_picture.url }}" alt="Profile" class="profile-img">
      {% else %}
        <img src="{% static 'img/default_profile.jpg' %}" alt="Default Profile" class="profile-img">
      {% endif %}
      <h6 class="profile-name">{{ request.user.first_name }}</h6>
      <p class="email" title="{{ request.user.email }}">{{ request.user.email }}</p>
    </div>

    <div class="sidebar-nav">
      <a hx-get="{% url 'dashboard:home' %}" hx-target="#dashboard-content" hx-swap="innerHTML" class="nav-item">
        <i class="bi bi-house"></i><span>Home</span>
      </a>

      <a hx-get="{% url 'tickets:ticket_overview' %}" hx-target="#dashboard-content" hx-swap="innerHTML" class="nav-item">
        <i class="bi bi-ticket"></i><span>Tickets</span>
      </a>

      <a hx-get="{% url 'dashboard:history' %}" hx-target="#dashboard-content" hx-swap="innerHTML" class="nav-item">
        <i class="bi bi-clock-history"></i><span>History</span>
      </a>

      <a hx-get="{% url 'dashboard:settings' %}" hx-target="#dashboard-content" hx-swap="innerHTML" class="nav-item">
        <i class="bi bi-gear"></i><span>Settings</span>
      </a>
    </div>

    <form method="POST" action="{% url 'user:logout' %}">
      {% csrf_token %}
      <button type="submit" class="logout-btn">Logout</button>
    </form>
  </div>

  <div id="dashboard-content" class="content">
    {% block content %}
    {% endblock %}
  </div>

  <div id="loading" class="loading-overlay d-none">
    <div class="spinner-border text-primary" role="status"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
  
  document.body.addEventListener('htmx:beforeRequest', () => {
    document.getElementById('loading').classList.remove('d-none');
  });
  document.body.addEventListener('htmx:afterSwap', () => {
    document.getElementById('loading').classList.add('d-none');
  });
  document.body.addEventListener('htmx:afterRequest', () => {
    document.getElementById('loading').classList.add('d-none');
  });

  document.addEventListener('DOMContentLoaded', () => {
    htmx.ajax('GET', "{% url 'dashboard:home' %}", '#dashboard-content');
  });
</script>

  <style>
    .loading-overlay {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 9999;
    }
  </style>

</body>
</html>
